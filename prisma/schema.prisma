generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  password  String
  role      UserRole // "CUSTOMER" ou "SELLER"
  sales     Sale[]   @relation("SellerSales")   // vendas que o usuário é vendedor
  purchases Sale[]   @relation("CustomerPurchases") // vendas que o usuário é cliente
  products  Product[] // produtos cadastrados pelo vendedor
}

enum UserRole {
  CUSTOMER
  SELLER
}

model Product {
  id          Int      @id @default(autoincrement())
  title       String
  description String
  price       Float
  stock       Int
  photos      String[]
  sellerId    Int
  seller      User     @relation(fields: [sellerId], references: [id])
  sales       SaleProduct[]
}

model Sale {
  id         Int          @id @default(autoincrement())
  customerId Int
  sellerId   Int
  customer   User         @relation("CustomerPurchases", fields: [customerId], references: [id])
  seller     User         @relation("SellerSales", fields: [sellerId], references: [id])
  products   SaleProduct[]
  total      Float
  status     SaleStatus   @default(PENDING)
  createdAt  DateTime     @default(now())
}

model SaleProduct {
  id         Int      @id @default(autoincrement())
  saleId     Int
  productId  Int
  quantity   Int
  sale       Sale     @relation(fields: [saleId], references: [id])
  product    Product  @relation(fields: [productId], references: [id])
}

enum SaleStatus {
  PENDING
  COMPLETED
  CANCELLED
}
